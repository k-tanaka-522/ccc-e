#!/bin/bash
# Requirements Agent - è¦ä»¶å®šç¾©ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

# è¨­å®š
AGENT_NAME="Requirements Agent"
AGENT_VERSION="1.0.0"
CONFIG_DIR="config"
TEMPLATES_DIR="templates/requirements"
OUTPUT_DIR="../requirements"

# ãƒ­ã‚°é–¢æ•°
log_info() {
    echo -e "\033[1;34m[INFO]\033[0m $1"
}

log_success() {
    echo -e "\033[1;32m[SUCCESS]\033[0m $1"
}

log_error() {
    echo -e "\033[1;31m[ERROR]\033[0m $1"
}

# ä½¿ç”¨æ–¹æ³•ã®è¡¨ç¤º
show_usage() {
    cat << EOF
ğŸ“‹ Requirements Agent v${AGENT_VERSION}
================================

ä½¿ç”¨æ–¹æ³•:
  $0 [ã‚ªãƒ—ã‚·ãƒ§ãƒ³]

ã‚ªãƒ—ã‚·ãƒ§ãƒ³:
  --wizard    ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã§è¦ä»¶å®šç¾©
  --auto      ãŠã¾ã‹ã›ãƒ¢ãƒ¼ãƒ‰ã§è‡ªå‹•ç”Ÿæˆ
  --update    æ—¢å­˜è¦ä»¶ã®æ›´æ–°
  --validate  è¦ä»¶å®šç¾©ã®æ¤œè¨¼
  --export    è¦ä»¶å®šç¾©æ›¸ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  --send      ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«è¦ä»¶å®šç¾©ã‚’é€ä¿¡
  --help      ã“ã®ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º

ä¾‹:
  $0 --wizard
  $0 --auto "ECã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã—ãŸã„"
  $0 --update
  $0 --validate

EOF
}

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
init_project() {
    log_info "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™..."
    
    # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    mkdir -p "$OUTPUT_DIR" logs tmp
    
    # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
    if [ ! -f "$OUTPUT_DIR/index.md" ]; then
        generate_index
        log_success "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã—ãŸ"
    fi
    
    # æ±ºå®šè¨˜éŒ²ã®åˆæœŸåŒ–
    if [ ! -f "$OUTPUT_DIR/decision_log.md" ]; then
        init_decision_log
        log_success "æ±ºå®šè¨˜éŒ²ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ"
    fi
}

# ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç”Ÿæˆ
generate_index() {
    cat > "$OUTPUT_DIR/index.md" << 'EOF'
# ã“ã‚Œã‹ã‚‰æ±ºã‚ã‚‹ã“ã¨ãƒªã‚¹ãƒˆ

## âœ… å®Œäº†æ¸ˆã¿é …ç›®
- [x] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–

## ğŸ”„ é€²è¡Œä¸­ã®é …ç›®
- [ ] è¦ä»¶å®šç¾©è©³ç´°åŒ–

## ğŸ“‹ æœªç€æ‰‹ã®é …ç›®

### 1. ãƒ“ã‚¸ãƒã‚¹è¦ä»¶
- [ ] ã‚µãƒ¼ãƒ“ã‚¹æ¦‚è¦ã®æ˜ç¢ºåŒ–
- [ ] ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å®šç¾©
- [ ] ä¸»è¦æ©Ÿèƒ½ã®æ´—ã„å‡ºã—
- [ ] æˆåŠŸæŒ‡æ¨™ï¼ˆKPIï¼‰ã®è¨­å®š

### 2. æŠ€è¡“è¦ä»¶
- [ ] æƒ³å®šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã®æ±ºå®š
- [ ] å¯ç”¨æ€§ç›®æ¨™ï¼ˆSLOï¼‰ã®è¨­å®š
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ è¦ä»¶
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

### 3. AWSæ§‹æˆ
- [ ] æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®é¸æŠ
- [ ] ã‚³ã‚¹ãƒˆä¸Šé™ã®è¨­å®š
- [ ] ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®é¸æŠ
- [ ] ç½å®³å¾©æ—§æˆ¦ç•¥

### 4. é‹ç”¨è¦ä»¶
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é »åº¦
- [ ] ç›£è¦–é …ç›®ã®å®šç¾©
- [ ] ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
- [ ] é‹ç”¨ä½“åˆ¶

### 5. é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è¦ä»¶
- [ ] CI/CDæˆ¦ç•¥
- [ ] ç’°å¢ƒæˆ¦ç•¥ï¼ˆdev/staging/prodï¼‰
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹å¼
- [ ] ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥

## ğŸ¯ å„ªå…ˆåº¦ã®é«˜ã„æ±ºå®šäº‹é …
1. å¯ç”¨æ€§ç›®æ¨™ã®è¨­å®š
2. AWSæ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®é¸æŠ
3. ã‚³ã‚¹ãƒˆä¸Šé™ã®æ±ºå®š

## ğŸ“ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- Requirements Agent ã®å®Ÿè¡Œ
- è©³ç´°è¦ä»¶ã®å®šç¾©
- ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã¨ã®ç¢ºèª

EOF
}

# æ±ºå®šè¨˜éŒ²ã®åˆæœŸåŒ–
init_decision_log() {
    cat > "$OUTPUT_DIR/decision_log.md" << EOF
# æ±ºå®šäº‹é …è¨˜éŒ²

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: $(basename "$(pwd)")
- **ä½œæˆæ—¥**: $(date -I)
- **æœ€çµ‚æ›´æ–°**: $(date -I)
- **æ‹…å½“è€…**: Requirements Agent

## æ±ºå®šäº‹é …å±¥æ­´

### $(date -I) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
- **æ±ºå®šå†…å®¹**: è¦ä»¶å®šç¾©ãƒ—ãƒ­ã‚»ã‚¹ã®é–‹å§‹
- **ç†ç”±**: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºé–‹ç™ºã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã„ã€è¦ä»¶å®šç¾©ã‹ã‚‰å§‹ã‚ã‚‹
- **å½±éŸ¿**: å…¨ä½“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ–¹é‡ãŒæ±ºã¾ã‚‹
- **æ‰¿èªè€…**: Requirements Agent

### æœªæ±ºå®šäº‹é …
- ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã®è©³ç´°
- æŠ€è¡“è¦ä»¶ã®å…·ä½“åŒ–
- AWSæ§‹æˆã®é¸æŠ
- é‹ç”¨è¦ä»¶ã®æ˜ç¢ºåŒ–

## å¤‰æ›´å±¥æ­´
- $(date -I): æ±ºå®šè¨˜éŒ²ã‚’åˆæœŸåŒ–

EOF
}

# ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰
wizard_mode() {
    log_info "ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã™"
    
    # æ—¢å­˜è¦ä»¶ã®ç¢ºèª
    if [ -f "$OUTPUT_DIR/requirements.md" ]; then
        log_info "æ—¢å­˜ã®è¦ä»¶å®šç¾©ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ"
        read -p "æ—¢å­˜ã®è¦ä»¶ã‚’æ›´æ–°ã—ã¾ã™ã‹ï¼Ÿ (y/N): " update_existing
        if [ "$update_existing" != "y" ]; then
            log_info "å‡¦ç†ã‚’ä¸­æ­¢ã—ã¾ã—ãŸ"
            return 0
        fi
    fi
    
    echo ""
    echo "ğŸ“‹ è¦ä»¶å®šç¾©ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰"
    echo "===================="
    
    # 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºæœ¬æƒ…å ±
    echo ""
    echo "ğŸ“ 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºæœ¬æƒ…å ±"
    echo "========================"
    read -p "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå: " project_name
    read -p "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¦‚è¦ï¼ˆ1è¡Œã§ï¼‰: " project_desc
    read -p "é–‹ç™ºæœŸé–“ï¼ˆé€±ï¼‰: " development_period
    read -p "ãƒãƒ¼ãƒ ã‚µã‚¤ã‚º: " team_size
    
    # 2. ãƒ“ã‚¸ãƒã‚¹è¦ä»¶
    echo ""
    echo "ğŸ’¼ 2. ãƒ“ã‚¸ãƒã‚¹è¦ä»¶"
    echo "================="
    show_industry_templates
    read -p "æ¥­ç•Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ (1-6): " industry_template
    
    read -p "ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼: " target_users
    read -p "ä¸»è¦æ©Ÿèƒ½ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰: " main_features
    read -p "æˆåŠŸæŒ‡æ¨™ï¼ˆKPIï¼‰: " success_metrics
    
    # 3. æŠ€è¡“è¦ä»¶
    echo ""
    echo "ğŸ”§ 3. æŠ€è¡“è¦ä»¶"
    echo "============="
    read -p "æƒ³å®šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ï¼ˆåŒæ™‚æ¥ç¶šï¼‰: " concurrent_users
    read -p "æƒ³å®šãƒ‡ãƒ¼ã‚¿é‡ï¼ˆGBï¼‰: " data_volume
    
    show_slo_options
    read -p "å¯ç”¨æ€§ç›®æ¨™é¸æŠ (1-4): " slo_choice
    
    read -p "ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ è¦ä»¶ï¼ˆç§’ï¼‰: " response_time
    
    # 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶
    echo ""
    echo "ğŸ”’ 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶"
    echo "===================="
    show_security_options
    read -p "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«é¸æŠ (1-4): " security_level
    
    read -p "å€‹äººæƒ…å ±ã‚’æ‰±ã„ã¾ã™ã‹ï¼Ÿ (y/N): " handle_pii
    read -p "æ±ºæ¸ˆæ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ (y/N): " payment_feature
    
    # 5. AWSæ§‹æˆ
    echo ""
    echo "â˜ï¸ 5. AWSæ§‹æˆ"
    echo "============"
    show_aws_patterns
    read -p "æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠ (1-3): " aws_pattern
    
    read -p "æœˆé¡ã‚³ã‚¹ãƒˆä¸Šé™ï¼ˆUSDï¼‰: " cost_limit
    read -p "ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆä¾‹ï¼šus-east-1ï¼‰: " region
    read -p "ãƒãƒ«ãƒAZæ§‹æˆãŒå¿…è¦ã§ã™ã‹ï¼Ÿ (y/N): " multi_az
    
    # 6. é‹ç”¨è¦ä»¶
    echo ""
    echo "ğŸ”§ 6. é‹ç”¨è¦ä»¶"
    echo "============="
    show_monitoring_options
    read -p "ç›£è¦–ãƒ¬ãƒ™ãƒ«é¸æŠ (1-3): " monitoring_level
    
    read -p "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é »åº¦ï¼ˆæ—¥ï¼‰: " backup_frequency
    read -p "ãƒ­ã‚°ä¿æŒæœŸé–“ï¼ˆæ—¥ï¼‰: " log_retention
    
    # 7. é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è¦ä»¶
    echo ""
    echo "ğŸš€ 7. é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è¦ä»¶"
    echo "====================="
    show_cicd_options
    read -p "CI/CDæˆ¦ç•¥é¸æŠ (1-3): " cicd_strategy
    
    read -p "ç’°å¢ƒæ•°ï¼ˆdev/staging/prodï¼‰: " env_count
    read -p "ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦ï¼ˆé€±ï¼‰: " deploy_frequency
    
    # è¦ä»¶å®šç¾©æ›¸ã®ç”Ÿæˆ
    generate_detailed_requirements "$project_name" "$project_desc" "$development_period" "$team_size" "$industry_template" "$target_users" "$main_features" "$success_metrics" "$concurrent_users" "$data_volume" "$slo_choice" "$response_time" "$security_level" "$handle_pii" "$payment_feature" "$aws_pattern" "$cost_limit" "$region" "$multi_az" "$monitoring_level" "$backup_frequency" "$log_retention" "$cicd_strategy" "$env_count" "$deploy_frequency"
    
    # æ±ºå®šè¨˜éŒ²ã®æ›´æ–°
    update_decision_log "ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰å®Œäº†" "å…¨è¦ä»¶ã‚’å¯¾è©±å½¢å¼ã§å®šç¾©" "è¦ä»¶å®šç¾©æ›¸ã®ç”Ÿæˆå®Œäº†"
    
    log_success "ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ"
}

# ãŠã¾ã‹ã›ãƒ¢ãƒ¼ãƒ‰
auto_mode() {
    local description="$1"
    
    if [ -z "$description" ]; then
        read -p "ä½œã‚ŠãŸã„ã‚µãƒ¼ãƒ“ã‚¹ã‚’èª¬æ˜ã—ã¦ãã ã•ã„: " description
    fi
    
    log_info "ãŠã¾ã‹ã›ãƒ¢ãƒ¼ãƒ‰ã§è¦ä»¶ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™"
    log_info "èª¬æ˜: $description"
    
    # ç°¡å˜ãªåˆ†æã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®è¨­å®š
    analyze_description "$description"
    
    # æ±ºå®šè¨˜éŒ²ã®æ›´æ–°
    update_decision_log "ãŠã¾ã‹ã›ãƒ¢ãƒ¼ãƒ‰å®Œäº†" "AIã«ã‚ˆã‚‹è‡ªå‹•è¦ä»¶ç”Ÿæˆ" "æ¥­ç•Œæ¨™æº–å€¤ã§åˆæœŸè¨­å®š"
    
    log_success "ãŠã¾ã‹ã›ãƒ¢ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ"
    log_info "ç”Ÿæˆã•ã‚ŒãŸè¦ä»¶ã‚’ç¢ºèªã—ã€å¿…è¦ã«å¿œã˜ã¦ --update ã§èª¿æ•´ã—ã¦ãã ã•ã„"
}

# èª¬æ˜æ–‡ã®åˆ†æ
analyze_description() {
    local description="$1"
    
    # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åˆ†æï¼ˆç°¡æ˜“ç‰ˆï¼‰
    local industry="ãã®ä»–"
    local pattern="2"  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆ
    
    if [[ "$description" =~ (EC|ecommerce|é€šè²©|ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°) ]]; then
        industry="ECã‚µã‚¤ãƒˆ"
        pattern="2"
    elif [[ "$description" =~ (SaaS|API|ã‚µãƒ¼ãƒ“ã‚¹) ]]; then
        industry="SaaS"
        pattern="2"
    elif [[ "$description" =~ (ãƒ¡ãƒ‡ã‚£ã‚¢|ãƒ–ãƒ­ã‚°|CMS) ]]; then
        industry="ãƒ¡ãƒ‡ã‚£ã‚¢"
        pattern="3"
    elif [[ "$description" =~ (ç¤¾å†…|ç®¡ç†|internal) ]]; then
        industry="ç¤¾å†…ã‚·ã‚¹ãƒ†ãƒ "
        pattern="1"
    fi
    
    log_info "åˆ†æçµæœ: $industry"
    
    # è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸè¦ä»¶å®šç¾©æ›¸
    cat > "$OUTPUT_DIR/requirements.md" << EOF
# è¦ä»¶å®šç¾©æ›¸ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
- **ã‚µãƒ¼ãƒ“ã‚¹æ¦‚è¦**: ${description}
- **æ¨å®šæ¥­ç•Œ**: ${industry}
- **ä½œæˆæ—¥**: $(date -I)
- **ç”Ÿæˆæ–¹æ³•**: AIãŠã¾ã‹ã›ãƒ¢ãƒ¼ãƒ‰

## ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ï¼ˆæ¨å®šï¼‰
- **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼**: ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **ä¸»è¦æ©Ÿèƒ½**: åŸºæœ¬çš„ãªCRUDæ“ä½œ
- **æˆåŠŸæŒ‡æ¨™**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã€åˆ©ç”¨ç‡

## æŠ€è¡“è¦ä»¶ï¼ˆæ¥­ç•Œæ¨™æº–ï¼‰
- **æƒ³å®šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°**: 1,000äººï¼ˆåŒæ™‚æ¥ç¶šï¼‰
- **æƒ³å®šãƒ‡ãƒ¼ã‚¿é‡**: 100GB
- **å¯ç”¨æ€§ç›®æ¨™**: 99.9%
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ **: 2ç§’ä»¥å†…

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«**: æ¨™æº–
- **å€‹äººæƒ…å ±**: è¦ç¢ºèª
- **æ±ºæ¸ˆæ©Ÿèƒ½**: è¦ç¢ºèª

## AWSæ§‹æˆï¼ˆæ¨å¥¨ï¼‰
- **æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³**: ãƒ‘ã‚¿ãƒ¼ãƒ³${pattern}
- **ã‚³ã‚¹ãƒˆä¸Šé™**: 500 USD/æœˆ
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: us-east-1
- **ãƒãƒ«ãƒAZ**: æ¨å¥¨

## é‹ç”¨è¦ä»¶ï¼ˆæ¨™æº–ï¼‰
- **ç›£è¦–ãƒ¬ãƒ™ãƒ«**: æ¨™æº–
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é »åº¦**: 1æ—¥æ¯
- **ãƒ­ã‚°ä¿æŒæœŸé–“**: 30æ—¥

## é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è¦ä»¶
- **CI/CDæˆ¦ç•¥**: æ¨™æº–çš„ãªGitHub Actions
- **ç’°å¢ƒæ•°**: 3ç’°å¢ƒï¼ˆdev/staging/prodï¼‰
- **ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦**: é€±1å›

## âš ï¸ è¦èª¿æ•´é …ç›®
ä»¥ä¸‹ã®é …ç›®ã¯è©³ç´°ãªæ¤œè¨ãŒå¿…è¦ã§ã™ï¼š

### é«˜å„ªå…ˆåº¦
- [ ] è©³ç´°ãªãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã®ç¢ºèª
- [ ] å®Ÿéš›ã®æƒ³å®šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã®æ˜ç¢ºåŒ–
- [ ] ã‚³ã‚¹ãƒˆè¦ä»¶ã®è¦‹ç›´ã—

### ä¸­å„ªå…ˆåº¦
- [ ] æŠ€è¡“è¦ä»¶ã®è©³ç´°åŒ–
- [ ] é‹ç”¨è¦ä»¶ã®èª¿æ•´
- [ ] é–‹ç™ºä½“åˆ¶ã®ç¢ºèª

### ä½å„ªå…ˆåº¦
- [ ] è©³ç´°ãªæ©Ÿèƒ½è¦ä»¶
- [ ] UI/UXè¦ä»¶
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
1. \`--update\` ã§è¦ä»¶ã®è©³ç´°åŒ–
2. ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã¨ã®è¦ä»¶ç¢ºèª
3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆã®é–‹å§‹

EOF
}

# æ¥­ç•Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è¡¨ç¤º
show_industry_templates() {
    echo "ğŸ“‹ æ¥­ç•Œåˆ¥ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼š"
    echo "1. ECã‚µã‚¤ãƒˆ - é«˜å¯ç”¨æ€§ã€æ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ ã€åœ¨åº«ç®¡ç†"
    echo "2. SaaS - ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã€APIä¸­å¿ƒã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³"
    echo "3. ãƒ¡ãƒ‡ã‚£ã‚¢ - é«˜ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã€CDNã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é…ä¿¡"
    echo "4. ç¤¾å†…ã‚·ã‚¹ãƒ†ãƒ  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‡è¦–ã€å®‰å®šæ€§å„ªå…ˆ"
    echo "5. ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ— - ä½ã‚³ã‚¹ãƒˆã€è¿…é€Ÿãƒ‡ãƒ—ãƒ­ã‚¤ã€MVP"
    echo "6. ãã®ä»– - ã‚«ã‚¹ã‚¿ãƒ è¨­å®š"
}

# SLOã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º
show_slo_options() {
    echo "ğŸ“Š å¯ç”¨æ€§ç›®æ¨™ï¼ˆSLOï¼‰ï¼š"
    echo "1. 99.0%  - æœˆé–“7.2æ™‚é–“ãƒ€ã‚¦ãƒ³ï¼ˆé–‹ç™ºç’°å¢ƒï¼‰"
    echo "2. 99.9%  - æœˆé–“43åˆ†ãƒ€ã‚¦ãƒ³ï¼ˆæœ¬ç•ªç’°å¢ƒãƒ»æ¨™æº–ï¼‰"
    echo "3. 99.95% - æœˆé–“21åˆ†ãƒ€ã‚¦ãƒ³ï¼ˆé‡è¦ã‚·ã‚¹ãƒ†ãƒ ï¼‰"
    echo "4. 99.99% - æœˆé–“4åˆ†ãƒ€ã‚¦ãƒ³ï¼ˆãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ï¼‰"
}

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º
show_security_options() {
    echo "ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ï¼š"
    echo "1. åŸºæœ¬ - æ¨™æº–çš„ãªèªè¨¼ãƒ»èªå¯"
    echo "2. æ¨™æº– - WAFã€æš—å·åŒ–ã€ç›£æŸ»ãƒ­ã‚°"
    echo "3. é«˜ - å¤šè¦ç´ èªè¨¼ã€è©³ç´°ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡"
    echo "4. æœ€é«˜ - RBACã€æš—å·åŒ–ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¯¾å¿œ"
}

# AWSæ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¡¨ç¤º
show_aws_patterns() {
    echo "â˜ï¸ AWSæ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š"
    echo "1. ã‚·ãƒ³ãƒ—ãƒ«æ§‹æˆ - EC2 + RDSï¼ˆä½ã‚³ã‚¹ãƒˆã€ã‚·ãƒ³ãƒ—ãƒ«ï¼‰"
    echo "2. ã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆ - ECS + RDSï¼ˆã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã€ãƒ¢ãƒ€ãƒ³ï¼‰"
    echo "3. ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹æ§‹æˆ - Lambda + DynamoDBï¼ˆé‹ç”¨ãƒ¬ã‚¹ã€å¾“é‡èª²é‡‘ï¼‰"
}

# ç›£è¦–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º
show_monitoring_options() {
    echo "ğŸ“Š ç›£è¦–ãƒ¬ãƒ™ãƒ«ï¼š"
    echo "1. åŸºæœ¬ - CloudWatchæ¨™æº–ãƒ¡ãƒˆãƒªã‚¯ã‚¹"
    echo "2. æ¨™æº– - ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ + ã‚¢ãƒ©ãƒ¼ãƒˆ + ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰"
    echo "3. é«˜åº¦ - X-Ray + è©³ç´°ãƒ­ã‚° + å¤–éƒ¨ç›£è¦– + PagerDuty"
}

# CI/CDã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º
show_cicd_options() {
    echo "ğŸš€ CI/CDæˆ¦ç•¥ï¼š"
    echo "1. ã‚·ãƒ³ãƒ—ãƒ« - GitHub ActionsåŸºæœ¬æ§‹æˆ"
    echo "2. æ¨™æº– - GitHub Actions + ãƒ†ã‚¹ãƒˆ + ãƒ‡ãƒ—ãƒ­ã‚¤è‡ªå‹•åŒ–"
    echo "3. é«˜åº¦ - GitHub Actions + è¤‡æ•°ç’°å¢ƒ + æ‰¿èªãƒ•ãƒ­ãƒ¼"
}

# è©³ç´°è¦ä»¶å®šç¾©æ›¸ã®ç”Ÿæˆ
generate_detailed_requirements() {
    # å¼•æ•°ã®å—ã‘å–ã‚Šï¼ˆé•·ã„ã®ã§çœç•¥è¡¨è¨˜ï¼‰
    local project_name="$1"
    local project_desc="$2"
    # ... ãã®ä»–ã®å¼•æ•°
    
    cat > "$OUTPUT_DIR/requirements.md" << EOF
# è¦ä»¶å®šç¾©æ›¸

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: ${project_name}
- **æ¦‚è¦**: ${project_desc}
- **ä½œæˆæ—¥**: $(date -I)
- **æœ€çµ‚æ›´æ–°**: $(date -I)

## ãƒ“ã‚¸ãƒã‚¹è¦ä»¶
- **æ¥­ç•Œåˆ†é¡**: ${industry_template}
- **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼**: ${target_users}
- **ä¸»è¦æ©Ÿèƒ½**: ${main_features}
- **æˆåŠŸæŒ‡æ¨™**: ${success_metrics}

## æŠ€è¡“è¦ä»¶
- **æƒ³å®šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°**: ${concurrent_users}äººï¼ˆåŒæ™‚æ¥ç¶šï¼‰
- **æƒ³å®šãƒ‡ãƒ¼ã‚¿é‡**: ${data_volume}GB
- **å¯ç”¨æ€§ç›®æ¨™**: $(get_slo_value "$slo_choice")
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ **: ${response_time}ç§’ä»¥å†…

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«**: ãƒ¬ãƒ™ãƒ«${security_level}
- **å€‹äººæƒ…å ±å–æ‰±**: ${handle_pii}
- **æ±ºæ¸ˆæ©Ÿèƒ½**: ${payment_feature}

## AWSæ§‹æˆ
- **æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³**: ãƒ‘ã‚¿ãƒ¼ãƒ³${aws_pattern}
- **ã‚³ã‚¹ãƒˆä¸Šé™**: ${cost_limit} USD/æœˆ
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: ${region}
- **ãƒãƒ«ãƒAZ**: ${multi_az}

## é‹ç”¨è¦ä»¶
- **ç›£è¦–ãƒ¬ãƒ™ãƒ«**: ãƒ¬ãƒ™ãƒ«${monitoring_level}
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é »åº¦**: ${backup_frequency}æ—¥æ¯
- **ãƒ­ã‚°ä¿æŒæœŸé–“**: ${log_retention}æ—¥

## é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è¦ä»¶
- **CI/CDæˆ¦ç•¥**: æˆ¦ç•¥${cicd_strategy}
- **ç’°å¢ƒæ•°**: ${env_count}ç’°å¢ƒ
- **ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦**: é€±${deploy_frequency}å›

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†
- **é–‹ç™ºæœŸé–“**: ${development_period}é€±
- **ãƒãƒ¼ãƒ ã‚µã‚¤ã‚º**: ${team_size}äºº

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
1. ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ¬ãƒ“ãƒ¥ãƒ¼
2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ
3. æŠ€è¡“é¸å®š
4. å®Ÿè£…è¨ˆç”»ç­–å®š

EOF
}

# SLOå€¤ã®å–å¾—
get_slo_value() {
    case "$1" in
        1) echo "99.0%" ;;
        2) echo "99.9%" ;;
        3) echo "99.95%" ;;
        4) echo "99.99%" ;;
        *) echo "99.9%" ;;
    esac
}

# æ±ºå®šè¨˜éŒ²ã®æ›´æ–°
update_decision_log() {
    local decision="$1"
    local reason="$2"
    local impact="$3"
    
    cat >> "$OUTPUT_DIR/decision_log.md" << EOF

### $(date -I) - ${decision}
- **æ±ºå®šå†…å®¹**: ${decision}
- **ç†ç”±**: ${reason}
- **å½±éŸ¿**: ${impact}
- **æ‰¿èªè€…**: Requirements Agent
- **æ›´æ–°æ™‚åˆ»**: $(date '+%Y-%m-%d %H:%M:%S')

EOF
}

# è¦ä»¶ã®æ›´æ–°
update_requirements() {
    log_info "è¦ä»¶ã®æ›´æ–°ã‚’é–‹å§‹ã—ã¾ã™"
    
    if [ ! -f "$OUTPUT_DIR/requirements.md" ]; then
        log_error "è¦ä»¶å®šç¾©æ›¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã¾ãš --wizard ã¾ãŸã¯ --auto ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„"
        return 1
    fi
    
    echo "ç¾åœ¨ã®è¦ä»¶å®šç¾©æ›¸ã‚’è¡¨ç¤ºã—ã¾ã™ï¼š"
    echo "================================"
    cat "$OUTPUT_DIR/requirements.md"
    echo "================================"
    
    echo ""
    echo "æ›´æ–°ã™ã‚‹é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š"
    echo "1. ãƒ“ã‚¸ãƒã‚¹è¦ä»¶"
    echo "2. æŠ€è¡“è¦ä»¶"
    echo "3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶"
    echo "4. AWSæ§‹æˆ"
    echo "5. é‹ç”¨è¦ä»¶"
    echo "6. é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è¦ä»¶"
    echo "7. å…¨ä½“çš„ãªè¦‹ç›´ã—"
    
    read -p "é¸æŠ (1-7): " update_choice
    
    case "$update_choice" in
        1) update_business_requirements ;;
        2) update_technical_requirements ;;
        3) update_security_requirements ;;
        4) update_aws_requirements ;;
        5) update_operational_requirements ;;
        6) update_development_requirements ;;
        7) wizard_mode ;;
        *) log_error "ç„¡åŠ¹ãªé¸æŠã§ã™" ;;
    esac
}

# ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã®æ›´æ–°
update_business_requirements() {
    echo "ğŸ“‹ ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã®æ›´æ–°"
    echo "===================="
    
    read -p "æ–°ã—ã„ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆç¾åœ¨ã®å€¤ã‚’å¤‰æ›´ã™ã‚‹å ´åˆï¼‰: " new_target_users
    read -p "æ–°ã—ã„ä¸»è¦æ©Ÿèƒ½ï¼ˆç¾åœ¨ã®å€¤ã‚’å¤‰æ›´ã™ã‚‹å ´åˆï¼‰: " new_main_features
    read -p "æ–°ã—ã„æˆåŠŸæŒ‡æ¨™ï¼ˆç¾åœ¨ã®å€¤ã‚’å¤‰æ›´ã™ã‚‹å ´åˆï¼‰: " new_success_metrics
    
    # æ›´æ–°å‡¦ç†ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯ sed ã‚„ awk ã‚’ä½¿ç”¨ï¼‰
    log_info "ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã‚’æ›´æ–°ã—ã¾ã—ãŸ"
    
    # æ±ºå®šè¨˜éŒ²ã®æ›´æ–°
    update_decision_log "ãƒ“ã‚¸ãƒã‚¹è¦ä»¶æ›´æ–°" "ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯" "è¦ä»¶ã®ç²¾åº¦å‘ä¸Š"
}

# æŠ€è¡“è¦ä»¶ã®æ›´æ–°
update_technical_requirements() {
    echo "ğŸ”§ æŠ€è¡“è¦ä»¶ã®æ›´æ–°"
    echo "================"
    
    read -p "æ–°ã—ã„æƒ³å®šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: " new_concurrent_users
    read -p "æ–°ã—ã„æƒ³å®šãƒ‡ãƒ¼ã‚¿é‡ï¼ˆGBï¼‰: " new_data_volume
    
    show_slo_options
    read -p "æ–°ã—ã„å¯ç”¨æ€§ç›®æ¨™é¸æŠ (1-4): " new_slo_choice
    
    read -p "æ–°ã—ã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ è¦ä»¶ï¼ˆç§’ï¼‰: " new_response_time
    
    # æ›´æ–°å‡¦ç†
    log_info "æŠ€è¡“è¦ä»¶ã‚’æ›´æ–°ã—ã¾ã—ãŸ"
    
    # æ±ºå®šè¨˜éŒ²ã®æ›´æ–°
    update_decision_log "æŠ€è¡“è¦ä»¶æ›´æ–°" "ã‚ˆã‚Šè©³ç´°ãªè¦ä»¶ãŒåˆ¤æ˜" "æŠ€è¡“é¸å®šã¸ã®å½±éŸ¿"
}

# è¦ä»¶ã®æ¤œè¨¼
validate_requirements() {
    log_info "è¦ä»¶å®šç¾©ã®æ¤œè¨¼ã‚’é–‹å§‹ã—ã¾ã™"
    
    if [ ! -f "$OUTPUT_DIR/requirements.md" ]; then
        log_error "è¦ä»¶å®šç¾©æ›¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        return 1
    fi
    
    local validation_errors=0
    
    echo "ğŸ” è¦ä»¶å®šç¾©æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ"
    echo "======================="
    
    # å¿…é ˆé …ç›®ã®ãƒã‚§ãƒƒã‚¯
    echo ""
    echo "ğŸ“‹ å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯:"
    
    if ! grep -q "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå" "$OUTPUT_DIR/requirements.md"; then
        echo "âŒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåãŒæœªå®šç¾©"
        ((validation_errors++))
    else
        echo "âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå"
    fi
    
    if ! grep -q "å¯ç”¨æ€§ç›®æ¨™" "$OUTPUT_DIR/requirements.md"; then
        echo "âŒ å¯ç”¨æ€§ç›®æ¨™ãŒæœªå®šç¾©"
        ((validation_errors++))
    else
        echo "âœ… å¯ç”¨æ€§ç›®æ¨™"
    fi
    
    if ! grep -q "æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³" "$OUTPUT_DIR/requirements.md"; then
        echo "âŒ AWSæ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæœªå®šç¾©"
        ((validation_errors++))
    else
        echo "âœ… AWSæ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³"
    fi
    
    # æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
    echo ""
    echo "ğŸ”„ æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯:"
    
    # å¯ç”¨æ€§ã¨ã‚³ã‚¹ãƒˆã®æ•´åˆæ€§
    if grep -q "99.99%" "$OUTPUT_DIR/requirements.md" && grep -q "100 USD" "$OUTPUT_DIR/requirements.md"; then
        echo "âš ï¸  99.99%ã®å¯ç”¨æ€§ã§æœˆ100USDã¯å®Ÿç¾å›°é›£"
        ((validation_errors++))
    fi
    
    # çµæœã®è¡¨ç¤º
    echo ""
    if [ $validation_errors -eq 0 ]; then
        echo "âœ… æ¤œè¨¼å®Œäº†: ã‚¨ãƒ©ãƒ¼ãªã—"
        log_success "è¦ä»¶å®šç¾©ã¯æœ‰åŠ¹ã§ã™"
    else
        echo "âŒ æ¤œè¨¼å®Œäº†: ${validation_errors}å€‹ã®ã‚¨ãƒ©ãƒ¼"
        log_error "$validation_errors å€‹ã®å•é¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ"
    fi
    
    # æ”¹å–„ææ¡ˆ
    echo ""
    echo "ğŸ’¡ æ”¹å–„ææ¡ˆ:"
    echo "- è¦ä»¶ã®å„ªå…ˆé †ä½ã‚’æ˜ç¢ºåŒ–"
    echo "- éæ©Ÿèƒ½è¦ä»¶ã®å…·ä½“åŒ–"
    echo "- ãƒªã‚¹ã‚¯ã®è­˜åˆ¥ã¨å¯¾ç­–"
    
    return $validation_errors
}

# è¦ä»¶å®šç¾©æ›¸ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
export_requirements() {
    log_info "è¦ä»¶å®šç¾©æ›¸ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã™"
    
    if [ ! -f "$OUTPUT_DIR/requirements.md" ]; then
        log_error "è¦ä»¶å®šç¾©æ›¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        return 1
    fi
    
    local export_dir="exports"
    mkdir -p "$export_dir"
    
    # æ—¥ä»˜ä»˜ããƒ•ã‚¡ã‚¤ãƒ«å
    local timestamp=$(date +%Y%m%d_%H%M%S)
    local export_file="$export_dir/requirements_$timestamp.md"
    
    # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä»˜ãã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    cat > "$export_file" << EOF
# è¦ä»¶å®šç¾©æ›¸ï¼ˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç‰ˆï¼‰

**ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ—¥æ™‚**: $(date '+%Y-%m-%d %H:%M:%S')  
**ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè€…**: Requirements Agent  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: ${AGENT_VERSION}  

---

EOF
    
    cat "$OUTPUT_DIR/requirements.md" >> "$export_file"
    
    log_success "è¦ä»¶å®šç¾©æ›¸ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ: $export_file"
    
    # çµ±è¨ˆæƒ…å ±ã®ç”Ÿæˆ
    echo ""
    echo "ğŸ“Š è¦ä»¶å®šç¾©çµ±è¨ˆ:"
    echo "- æ–‡å­—æ•°: $(wc -c < "$OUTPUT_DIR/requirements.md")"
    echo "- è¡Œæ•°: $(wc -l < "$OUTPUT_DIR/requirements.md")"
    echo "- æ±ºå®šæ¸ˆã¿é …ç›®: $(grep -c "âœ…" "$OUTPUT_DIR/requirements.md" 2>/dev/null || echo 0)"
    echo "- æœªæ±ºå®šé …ç›®: $(grep -c "âŒ" "$OUTPUT_DIR/requirements.md" 2>/dev/null || echo 0)"
}

# ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«è¦ä»¶å®šç¾©ã‚’é€ä¿¡
send_to_agents() {
    if [ ! -f "$OUTPUT_DIR/requirements.md" ]; then
        log_error "è¦ä»¶å®šç¾©æ›¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        return 1
    fi
    
    log_info "è¦ä»¶å®šç¾©ã‚’ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«é€ä¿¡ã—ã¦ã„ã¾ã™..."
    
    # Architect Agentã«é€ä¿¡
    if [ -f "../core/agent-send.sh" ]; then
        ../core/agent-send.sh architect "è¦ä»¶å®šç¾©ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚"
        log_success "Architect Agentã«è¦ä»¶å®šç¾©ã‚’é€ä¿¡ã—ã¾ã—ãŸ"
    else
        log_error "agent-send.shãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    fi
}

# ãƒ¡ã‚¤ãƒ³å‡¦ç†
main() {
    echo "ğŸ“‹ $AGENT_NAME v$AGENT_VERSION"
    echo "================================"
    
    # åˆæœŸåŒ–
    init_project
    
    # å¼•æ•°ã®å‡¦ç†
    case "$1" in
        --wizard)
            wizard_mode
            ;;
        --auto)
            auto_mode "$2"
            ;;
        --update)
            update_requirements
            ;;
        --validate)
            validate_requirements
            ;;
        --export)
            export_requirements
            ;;
        --send)
            send_to_agents
            ;;
        --help|"")
            show_usage
            ;;
        *)
            log_error "ä¸æ˜ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³: $1"
            show_usage
            exit 1
            ;;
    esac
}

# å®Ÿè¡Œ
main "$@"